<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="csrf-token" content="{{ .CSRF }}">
  <title>Time Punch</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@500;600;700;800&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/assets/app.css">
  <script>
    (function () {
      var stored = localStorage.getItem("cfasuite-theme");
      var prefersDark = window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches;
      var theme = stored === "light" || stored === "dark" ? stored : (prefersDark ? "dark" : "light");
      document.documentElement.classList.toggle("dark", theme === "dark");
    })();
  </script>
  <style>
    :root {
      --bg: #ffffff; --fg: #09090b; --card: #ffffff;
      --muted: #f4f4f5; --muted-fg: #71717a; --border: #e4e4e7;
      --primary: #004f71; --primary-fg: #ffffff;
      --danger: #dc2626; --success: #16a34a;
      --shadow: 0 1px 3px rgba(0,0,0,.06), 0 1px 2px rgba(0,0,0,.04);
    }
    html.dark {
      --bg: #09090b; --fg: #fafafa; --card: #09090b;
      --muted: #27272a; --muted-fg: #a1a1aa; --border: #3f3f46;
      --primary: #004f71; --primary-fg: #ffffff;
      --danger: #f87171; --success: #4ade80;
      --shadow: 0 1px 3px rgba(0,0,0,.4), 0 1px 2px rgba(0,0,0,.3);
    }
    *, *::before, *::after { box-sizing: border-box; }
    body { margin: 0; background-color: var(--bg); color: var(--fg); font-family: "Manrope", ui-sans-serif, system-ui, sans-serif; -webkit-font-smoothing: antialiased; }
    h1, h2, h3 { margin: 0; font-family: "Space Grotesk", "Manrope", sans-serif; font-weight: 700; line-height: 1.25; }
    h1 { font-size: clamp(1.375rem, 3vw, 1.875rem); }
    h2 { font-size: 1.125rem; }
    p { margin: 0; }
    a { color: var(--primary); text-decoration: none; }
    a:hover { text-decoration: underline; }
    .card, .panel { background-color: var(--card); border: 1px solid var(--border); border-radius: 0.75rem; padding: 1.5rem; box-shadow: var(--shadow); }
    @media (max-width: 639px) { .card, .panel { padding: 1rem; } }
    input:not([type="checkbox"]):not([type="radio"]):not([type="range"]):not([type="file"]):not([type="submit"]):not([type="button"]):not([type="reset"]), select, textarea { display: block; width: 100%; min-height: 2.375rem; padding: 0.5rem 0.75rem; font: 0.875rem/1.5 inherit; color: var(--fg); background-color: var(--bg); border: 1px solid var(--border); border-radius: 0.375rem; transition: border-color 150ms, box-shadow 150ms; }
    input:not([type="checkbox"]):not([type="radio"]):not([type="range"]):not([type="file"]):not([type="submit"]):not([type="button"]):not([type="reset"]):focus, select:focus, textarea:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(0,79,113,.15); }
    html.dark input:focus, html.dark select:focus, html.dark textarea:focus { box-shadow: 0 0 0 3px rgba(0,79,113,.15); }
    label { display: block; font-size: 0.875rem; font-weight: 600; margin-bottom: 0.375rem; }
    .table-wrap { overflow-x: auto; border: 1px solid var(--border); border-radius: 0.5rem; }
    table { width: 100%; border-collapse: collapse; font-size: 0.875rem; }
    th { text-align: left; padding: 0.625rem 0.875rem; font-size: 0.6875rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.06em; color: var(--muted-fg); background-color: var(--muted); border-bottom: 1px solid var(--border); white-space: nowrap; }
    td { padding: 0.625rem 0.875rem; border-bottom: 1px solid var(--border); vertical-align: middle; }
    tbody tr:last-child td { border-bottom: none; }
    .text-muted { color: var(--muted-fg); font-size: 0.875rem; }
    .btn { display: inline-flex; align-items: center; justify-content: center; gap: 0.375rem; min-height: 2.375rem; padding: 0.5rem 0.875rem; font: 600 0.875rem/1.25 inherit; border-radius: 0.375rem; border: 1px solid transparent; cursor: pointer; transition: 150ms; white-space: nowrap; }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .btn-primary { background-color: var(--primary); color: var(--primary-fg); border-color: var(--primary); }
    .btn-primary:hover:not(:disabled) { opacity: 0.9; }
    .btn-secondary { background-color: var(--bg); color: var(--fg); border-color: var(--border); }
    .btn-secondary:hover:not(:disabled) { background-color: var(--muted); }
    .btn-sm { min-height: 2rem; padding: 0.3125rem 0.625rem; font-size: 0.8125rem; }

    /* Back link */
    .back { font-size: 0.8125rem; font-weight: 500; color: var(--muted-fg); display: inline-flex; align-items: center; gap: 0.25rem; margin-bottom: 1rem; }
    .back:hover { color: var(--fg); text-decoration: none; }

    /* Sub heading */
    .sub { color: var(--muted-fg); font-size: 0.875rem; margin-top: 0.25rem; margin-bottom: 0; }

    /* Notice messages */
    .notice { margin: 0 0 0.625rem; font-size: 0.875rem; }
    .notice.ok { color: var(--success); font-weight: 500; }
    .notice.error { color: var(--danger); font-weight: 500; }

    /* Link box */
    .link-box { border: 1px solid var(--border); border-radius: 0.5rem; background: var(--bg); padding: 1rem; margin-bottom: 1.25rem; }
    .link-box > label { font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; color: var(--muted-fg); margin-bottom: 0.5rem; }
    .link-row { display: flex; gap: 0.5rem; flex-wrap: wrap; }
    .link-row input { flex: 1; min-width: 200px; font-family: ui-monospace, SFMono-Regular, Menlo, monospace; font-size: 0.8125rem; }

    /* Table delete button */
    td form button { background-color: transparent; color: var(--danger); border: 1px solid var(--border); border-radius: 0.3125rem; padding: 0.25rem 0.5rem; font: 500 0.8125rem/1.25 inherit; cursor: pointer; transition: 150ms; }
    td form button:hover { background-color: rgba(220,38,38,.08); border-color: var(--danger); }
    .submenu { display:flex; gap:.5rem; margin:0 0 1rem; flex-wrap:wrap; }
    .submenu-btn { padding:.375rem .75rem; font-size:.8125rem; font-weight:600; background:transparent; border:1px solid var(--border); border-radius:.375rem; cursor:pointer; color:var(--muted-fg); transition:150ms; }
    .submenu-btn:hover { background:var(--muted); color:var(--fg); }
    .submenu-btn.active { background:var(--fg); color:var(--bg); border-color:var(--fg); }
    .tab-panel[hidden] { display:none; }
  </style>
</head>
<body class="min-h-screen bg-white dark:bg-zinc-950 text-zinc-900 dark:text-zinc-100 transition-colors">

  <header class="fixed inset-x-0 top-0 z-50 h-14 border-b border-zinc-200 dark:border-zinc-800 bg-white/95 dark:bg-zinc-950/95 backdrop-blur-sm transition-colors">
    <div class="mx-auto max-w-6xl h-full px-4 flex items-center justify-between gap-4">
      <a href="/admin" class="text-sm font-bold text-zinc-900 dark:text-zinc-100 shrink-0" style="text-decoration:none">CFA Suite</a>
      <nav class="hidden md:flex items-center gap-1 flex-1" id="nav-desktop">
        <a href="/admin" class="text-xs font-semibold px-2.5 py-1.5 rounded-md text-zinc-600 dark:text-zinc-400 hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors">Locations</a>
        <a href="/admin/locations/{{ .Location.Number }}" class="text-xs font-semibold px-2.5 py-1.5 rounded-md text-zinc-600 dark:text-zinc-400 hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors">Apps</a>
        <a href="/admin/locations/{{ .Location.Number }}/time-punch" class="text-xs font-semibold px-2.5 py-1.5 rounded-md bg-zinc-900 text-white dark:bg-zinc-100 dark:text-zinc-900">Time Punch</a>
      </nav>
      <div class="flex items-center gap-2 shrink-0">
        <button id="theme-toggle" type="button" aria-label="Toggle theme" class="h-8 w-8 inline-flex items-center justify-center rounded-md border border-zinc-200 dark:border-zinc-700 bg-transparent text-zinc-500 dark:text-zinc-400 hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors">
          <svg class="h-4 w-4 block dark:hidden" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
          <svg class="h-4 w-4 hidden dark:block" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
        </button>
        <button id="nav-toggle" type="button" aria-expanded="false" aria-controls="nav-mobile" class="md:hidden h-8 w-8 inline-flex items-center justify-center rounded-md border border-zinc-200 dark:border-zinc-700 bg-transparent text-zinc-500 dark:text-zinc-400 hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors">
          <span class="sr-only">Open menu</span>
          <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 7h16M4 12h16M4 17h16"/></svg>
        </button>
      </div>
    </div>
    <div id="nav-mobile" class="hidden md:hidden border-t border-zinc-200 dark:border-zinc-800 px-4 py-2 bg-white dark:bg-zinc-950 flex-col gap-1">
      <a href="/admin" class="text-xs font-semibold px-2.5 py-1.5 rounded-md text-zinc-600 dark:text-zinc-400 hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors">Locations</a>
      <a href="/admin/locations/{{ .Location.Number }}" class="text-xs font-semibold px-2.5 py-1.5 rounded-md text-zinc-600 dark:text-zinc-400 hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors">Apps</a>
      <a href="/admin/locations/{{ .Location.Number }}/time-punch" class="text-xs font-semibold px-2.5 py-1.5 rounded-md bg-zinc-900 text-white dark:bg-zinc-100 dark:text-zinc-900">Time Punch</a>
    </div>
  </header>

  <div class="pt-14 min-h-[calc(100vh-3.5rem)] px-4 py-8">
    <div class="mx-auto max-w-[1024px]">
      <div class="card">

        <a class="back" href="/admin/locations/{{ .Location.Number }}">&#8592; Back to Apps</a>

        <h1>Time Punch Corrections</h1>
        <p class="sub" style="margin-bottom:1rem;">{{ .Location.Name }} ({{ .Location.Number }})</p>

        {{ if .SuccessMessage }}<p class="notice ok">{{ .SuccessMessage }}</p>{{ end }}
        {{ if .Error }}<p class="notice error">{{ .Error }}</p>{{ end }}

        <div class="submenu" role="tablist" aria-label="Time punch sections">
          <button type="button" class="submenu-btn active" data-panel-target="create-punch" role="tab" aria-selected="true">Create Time Punch</button>
          <button type="button" class="submenu-btn" data-panel-target="view-punches" role="tab" aria-selected="false">View Time Punches</button>
          <button type="button" class="submenu-btn" data-panel-target="archived-punches" role="tab" aria-selected="false">Archived Punches</button>
        </div>

        <section class="tab-panel" data-panel-name="create-punch">
          <section class="link-box">
            <label>Secret Employee Submission Link</label>
            <div class="link-row">
              <input id="punch-link" type="text" readonly value="{{ .TimePunchLink }}">
              <button id="copy-btn" type="button" class="btn btn-secondary btn-sm">Copy Link</button>
              <button id="open-btn" type="button" class="btn btn-secondary btn-sm">Open Form</button>
            </div>
          </section>
          <section class="panel" style="padding:1rem;">
            <h2 style="margin-bottom:.25rem;">Submit Time Punch (Admin Test)</h2>
            <p class="text-muted" style="margin-bottom:.75rem;">Use this to submit a time punch directly from this page.</p>
            <form method="post" action="/admin/locations/{{ .Location.Number }}/time-punch/create" style="display:grid;gap:.75rem;">
              <input type="hidden" name="csrf_token" value="{{ .CSRF }}">
              <div style="display:grid;gap:.75rem;grid-template-columns:repeat(2,minmax(0,1fr));">
                <div>
                  <label for="time_punch_name">Employee</label>
                  <select id="time_punch_name" name="time_punch_name" required>
                    <option value="">Select employee</option>
                    {{ range .Employees }}
                      <option value="{{ .TimePunchName }}">{{ .FirstName }} {{ .LastName }} ({{ .TimePunchName }})</option>
                    {{ end }}
                  </select>
                </div>
                <div>
                  <label for="punch_date">Date</label>
                  <input id="punch_date" name="punch_date" type="date" required>
                </div>
                <div>
                  <label for="time_in">Time In</label>
                  <input id="time_in" name="time_in" type="time" required>
                </div>
                <div>
                  <label for="time_out">Time Out</label>
                  <input id="time_out" name="time_out" type="time" required>
                </div>
              </div>
              <div>
                <label for="note">Note</label>
                <input id="note" name="note" type="text" maxlength="255" placeholder="Optional note">
              </div>
              <div class="row" style="margin-top:.25rem;">
                <button type="submit" class="btn btn-primary">Submit Time Punch</button>
              </div>
            </form>
          </section>
        </section>

        <section class="tab-panel" data-panel-name="view-punches" hidden>
          <p class="text-muted" style="margin-bottom:.75rem;">Showing up to the 50 most recent active punches.</p>
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>Submitted At</th>
                  <th>Employee</th>
                  <th>Date</th>
                  <th>Time In</th>
                  <th>Time Out</th>
                  <th>Note</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody>
                {{ if .TimePunchEntries }}
                  {{ range .TimePunchEntries }}
                    <tr>
                      <td>{{ .CreatedAt }}</td>
                      <td>{{ .TimePunchName }}</td>
                      <td>{{ .PunchDate }}</td>
                      <td>{{ .TimeIn }}</td>
                      <td>{{ .TimeOut }}</td>
                      <td>{{ .Note }}</td>
                      <td>
                        <form method="post" action="/admin/locations/{{ $.Location.Number }}/time-punch/{{ .ID }}/archive" onsubmit="return confirm('Archive this time punch entry?');">
                          <input type="hidden" name="csrf_token" value="{{ $.CSRF }}">
                          <button type="submit">Archive</button>
                        </form>
                      </td>
                    </tr>
                  {{ end }}
                {{ else }}
                  <tr><td colspan="7">No active time punches submitted yet.</td></tr>
                {{ end }}
              </tbody>
            </table>
          </div>
        </section>

        <section class="tab-panel" data-panel-name="archived-punches" hidden>
          <p class="text-muted" style="margin-bottom:.75rem;">Showing up to the 50 most recent archived punches.</p>
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>Submitted At</th>
                  <th>Archived At</th>
                  <th>Employee</th>
                  <th>Date</th>
                  <th>Time In</th>
                  <th>Time Out</th>
                  <th>Note</th>
                </tr>
              </thead>
              <tbody>
                {{ if .ArchivedTimePunchEntries }}
                  {{ range .ArchivedTimePunchEntries }}
                    <tr>
                      <td>{{ .CreatedAt }}</td>
                      <td>{{ .ArchivedAt }}</td>
                      <td>{{ .TimePunchName }}</td>
                      <td>{{ .PunchDate }}</td>
                      <td>{{ .TimeIn }}</td>
                      <td>{{ .TimeOut }}</td>
                      <td>{{ .Note }}</td>
                    </tr>
                  {{ end }}
                {{ else }}
                  <tr><td colspan="7">No archived punches yet.</td></tr>
                {{ end }}
              </tbody>
            </table>
          </div>
        </section>

      </div>
    </div>
  </div>

  <script>
    const submenuButtons = Array.from(document.querySelectorAll(".submenu-btn"));
    const tabPanels = Array.from(document.querySelectorAll(".tab-panel"));
    function setActivePanel(panelName, pushHash = true) {
      tabPanels.forEach((panel) => {
        panel.hidden = panel.dataset.panelName !== panelName;
      });
      submenuButtons.forEach((btn) => {
        const active = btn.dataset.panelTarget === panelName;
        btn.classList.toggle("active", active);
        btn.setAttribute("aria-selected", active ? "true" : "false");
      });
      if (pushHash && window.location.hash !== "#" + panelName) {
        window.location.hash = panelName;
      }
    }
    submenuButtons.forEach((btn) => {
      btn.addEventListener("click", () => setActivePanel(btn.dataset.panelTarget || "create-punch"));
    });
    const initialPanel = (window.location.hash || "").replace("#", "");
    if (initialPanel === "view-punches" || initialPanel === "archived-punches" || initialPanel === "create-punch") {
      setActivePanel(initialPanel, false);
    } else {
      setActivePanel("create-punch", false);
    }

    const copyBtn = document.getElementById("copy-btn");
    const openBtn = document.getElementById("open-btn");
    const linkInput = document.getElementById("punch-link");
    if (copyBtn && linkInput) copyBtn.addEventListener("click", async () => {
      try {
        await navigator.clipboard.writeText(linkInput.value);
        copyBtn.textContent = "Copied";
        window.setTimeout(() => { copyBtn.textContent = "Copy Link"; }, 1200);
      } catch (_) {
        linkInput.select();
        document.execCommand("copy");
      }
    });
    if (openBtn && linkInput) openBtn.addEventListener("click", () => {
      const target = (linkInput.value || "").trim();
      if (!target) return;
      window.location.href = target;
    });
  </script>
  <script>
    (function () {
      var storageKey = "cfasuite-theme";
      var root = document.documentElement;
      var toggle = document.getElementById("theme-toggle");
      var navToggle = document.getElementById("nav-toggle");
      var navMobile = document.getElementById("nav-mobile");
      if (toggle) {
        toggle.addEventListener("click", function () {
          var isDark = root.classList.toggle("dark");
          localStorage.setItem(storageKey, isDark ? "dark" : "light");
        });
      }
      if (navToggle && navMobile) {
        navToggle.addEventListener("click", function () {
          var expanded = navToggle.getAttribute("aria-expanded") === "true";
          navToggle.setAttribute("aria-expanded", expanded ? "false" : "true");
          navMobile.classList.toggle("hidden", expanded);
          if (!expanded) { navMobile.style.display = "flex"; } else { navMobile.style.removeProperty("display"); }
        });
      }
    })();
  </script>

</body>
</html>
