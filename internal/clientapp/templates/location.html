<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="csrf-token" content="{{ .CSRF }}">
  <title>Location Details</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/assets/app.css">
  <script defer src="/assets/upload-drop.js"></script>
  <script>
    (function () {
      var stored = localStorage.getItem("cfasuite-theme");
      var prefersDark = window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches;
      var theme = stored === "light" || stored === "dark" ? stored : (prefersDark ? "dark" : "light");
      document.documentElement.classList.toggle("dark", theme === "dark");
    })();
  </script>
  <style>
    :root {
      --bg: #ffffff; --fg: #09090b; --card: #ffffff;
      --muted: #f4f4f5; --muted-fg: #71717a; --border: #e4e4e7;
      --primary: #004f71; --primary-fg: #ffffff;
      --danger: #dc2626; --success: #16a34a;
      --shadow: 0 1px 3px rgba(0,0,0,.06), 0 1px 2px rgba(0,0,0,.04);
    }
    html.dark {
      --bg: #09090b; --fg: #fafafa; --card: #09090b;
      --muted: #27272a; --muted-fg: #a1a1aa; --border: #3f3f46;
      --primary: #004f71; --primary-fg: #ffffff;
      --danger: #f87171; --success: #4ade80;
      --shadow: 0 1px 3px rgba(0,0,0,.4), 0 1px 2px rgba(0,0,0,.3);
    }
    *, *::before, *::after { box-sizing: border-box; }
    body { margin: 0; background-color: var(--bg); color: var(--fg); font-family: "Manrope", ui-sans-serif, system-ui, sans-serif; -webkit-font-smoothing: antialiased; }
    h1, h2, h3 { margin: 0; font-family: "Space Grotesk", "Manrope", sans-serif; font-weight: 700; line-height: 1.25; }
    h1 { font-size: clamp(1.375rem, 3vw, 1.875rem); }
    h2 { font-size: 1.125rem; }
    p { margin: 0; }
    a { color: var(--primary); text-decoration: none; }
    a:hover { text-decoration: underline; }
    .card, .panel { background-color: var(--card); border: 1px solid var(--border); border-radius: 0.75rem; padding: 1.5rem; box-shadow: var(--shadow); }
    @media (max-width: 639px) { .card, .panel { padding: 1rem; } }
    input:not([type="checkbox"]):not([type="radio"]):not([type="range"]):not([type="file"]):not([type="submit"]):not([type="button"]):not([type="reset"]), select, textarea { display: block; width: 100%; min-height: 2.375rem; padding: 0.5rem 0.75rem; font: 0.875rem/1.5 inherit; color: var(--fg); background-color: var(--bg); border: 1px solid var(--border); border-radius: 0.375rem; transition: border-color 150ms, box-shadow 150ms; }
    input:not([type="checkbox"]):not([type="radio"]):not([type="range"]):not([type="file"]):not([type="submit"]):not([type="button"]):not([type="reset"]):focus, select:focus, textarea:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(0,79,113,.15); }
    html.dark input:not([type="checkbox"]):not([type="radio"]):not([type="range"]):not([type="file"]):not([type="submit"]):not([type="button"]):not([type="reset"]):focus, html.dark select:focus, html.dark textarea:focus { box-shadow: 0 0 0 3px rgba(0,79,113,.15); }
    label { display: block; font-size: 0.875rem; font-weight: 600; margin-bottom: 0.375rem; }
    .table-wrap { overflow-x: auto; border: 1px solid var(--border); border-radius: 0.5rem; }
    table { width: 100%; border-collapse: collapse; font-size: 0.875rem; }
    th { text-align: left; padding: 0.625rem 0.875rem; font-size: 0.6875rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.06em; color: var(--muted-fg); background-color: var(--muted); border-bottom: 1px solid var(--border); white-space: nowrap; }
    td { padding: 0.625rem 0.875rem; border-bottom: 1px solid var(--border); vertical-align: middle; }
    tbody tr:last-child td { border-bottom: none; }
    .text-muted { color: var(--muted-fg); font-size: 0.875rem; }
    .text-success { color: var(--success); }
    .text-danger { color: var(--danger); }

    .back { font-size: 0.8125rem; font-weight: 500; color: var(--muted-fg); display: inline-flex; align-items: center; margin-bottom: 1rem; }
    .back:hover { color: var(--fg); text-decoration: none; }

    .hub { display: grid; gap: 0.625rem; margin: 0.75rem 0 0; }
    .hub-btn { width: 100%; text-align: left; padding: 0.875rem 1rem; background-color: var(--bg); border: 1px solid var(--border); border-radius: 0.5rem; cursor: pointer; font-family: inherit; color: var(--fg); transition: 150ms; }
    .hub-btn:hover { background-color: var(--muted); }
    .hub-btn.active { background-color: var(--muted); border-color: var(--primary); }
    .hub-btn strong { display: block; font-size: 0.9375rem; font-weight: 600; margin-bottom: 0.25rem; }
    .hub-btn span { display: block; font-size: 0.8125rem; color: var(--muted-fg); }

    .section { display: none; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border); }
    .section.active { display: block; }

    .section h2 { margin-bottom: 0.75rem; }

    .section form { display: grid; gap: 0.625rem; }

    .section button[type="submit"] {
      background-color: var(--primary);
      color: var(--primary-fg);
      border: none;
      border-radius: 0.375rem;
      padding: 0.5rem 0.875rem;
      font: 600 0.875rem/1.25 inherit;
      cursor: pointer;
      min-height: 2.375rem;
    }
    .section button[type="submit"]:hover { opacity: 0.9; }

    .employees-head { display: flex; align-items: center; justify-content: space-between; gap: 0.625rem; flex-wrap: wrap; margin-bottom: 0.75rem; }

    .employee-search { display: grid; gap: 0.375rem; margin-bottom: 0.75rem; }
    .employee-search-meta { color: var(--muted-fg); font-size: 0.8125rem; }

    .location-link { color: var(--primary); font-weight: 600; }
    .location-link:hover { text-decoration: underline; }

    .archive-link { color: var(--primary); font-size: 0.8125rem; font-weight: 600; }
    .archive-link:hover { text-decoration: underline; }

    .notice { margin: 0 0 0.75rem; font-size: 0.875rem; font-weight: 600; }
    .notice.ok { color: var(--success); }
    .notice.error { color: var(--danger); }

    .meta-grid { display: grid; grid-template-columns: auto 1fr; gap: 0.25rem 1rem; font-size: 0.875rem; margin-bottom: 1.25rem; }
    .meta-label { color: var(--muted-fg); font-weight: 600; }
    .meta-value { font-weight: 600; }
    .bulk-subnav { display: grid; gap: 0.5rem; margin: 0.5rem 0 0.875rem; }
    @media (min-width: 640px) { .bulk-subnav { grid-template-columns: 1fr 1fr; } }
    .bulk-subbtn {
      width: 100%;
      text-align: left;
      padding: 0.625rem 0.75rem;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 0.5rem;
      color: var(--fg);
      font: 600 0.875rem/1.3 inherit;
      cursor: pointer;
      transition: 150ms;
    }
    .bulk-subbtn:hover { background: var(--muted); }
    .bulk-subbtn.active { border-color: var(--primary); background: var(--muted); }
    .bulk-panel { display: none; }
    .bulk-panel.active { display: block; }
    .employee-status-subnav { display: grid; gap: 0.5rem; margin: 0.5rem 0 0.875rem; }
    @media (min-width: 640px) { .employee-status-subnav { grid-template-columns: 1fr 1fr 1fr; } }
    .employee-status-btn {
      width: 100%;
      text-align: left;
      padding: 0.625rem 0.75rem;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 0.5rem;
      color: var(--fg);
      font: 600 0.875rem/1.3 inherit;
      cursor: pointer;
      transition: 150ms;
    }
    .employee-status-btn:hover { background: var(--muted); }
    .employee-status-btn.active { border-color: var(--primary); background: var(--muted); }
    .employee-status-panel { display: none; }
    .employee-status-panel.active { display: block; }
    .file-dropzone {
      position: relative;
      display: grid;
      gap: 0.375rem;
      border: 1.5px dashed var(--border);
      border-radius: 0.625rem;
      background: var(--bg);
      padding: 0.875rem;
      transition: border-color 150ms, background-color 150ms, box-shadow 150ms;
      cursor: pointer;
    }
    .file-dropzone:hover { border-color: var(--primary); background: var(--muted); }
    .file-dropzone.is-dragging {
      border-color: var(--primary);
      background: var(--muted);
      box-shadow: 0 0 0 3px rgba(0,79,113,.15);
    }
    .file-dropzone-title {
      font-size: 0.75rem;
      font-weight: 700;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      color: var(--muted-fg);
    }
    .file-dropzone-text {
      font-size: 0.875rem;
      color: var(--fg);
      font-weight: 600;
      word-break: break-word;
    }
    .file-dropzone-input {
      position: absolute;
      inset: 0;
      opacity: 0;
      cursor: pointer;
    }
  </style>
</head>
<body class="min-h-screen bg-white dark:bg-zinc-950 text-zinc-900 dark:text-zinc-100 transition-colors">

  <header class="fixed inset-x-0 top-0 z-50 h-14 border-b border-zinc-200 dark:border-zinc-800 bg-white/95 dark:bg-zinc-950/95 backdrop-blur-sm transition-colors">
    <div class="mx-auto max-w-6xl h-full px-4 flex items-center justify-between gap-4">
      <a href="/admin/locations/{{ .Location.Number }}" class="text-sm font-bold text-zinc-900 dark:text-zinc-100 shrink-0" style="text-decoration:none">CFA Suite</a>
      <nav class="hidden md:flex items-center gap-1 flex-1" id="nav-desktop">
        <a href="/admin/locations/{{ .Location.Number }}" class="text-xs font-semibold px-2.5 py-1.5 rounded-md text-zinc-600 dark:text-zinc-400 hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors">Apps</a>
        <a href="/admin/locations/{{ .Location.Number }}/employees" class="text-xs font-semibold px-2.5 py-1.5 rounded-md bg-zinc-900 text-white dark:bg-zinc-100 dark:text-zinc-900">Employees</a>
        <a href="/admin/locations/{{ .Location.Number }}/employees/archived" class="text-xs font-semibold px-2.5 py-1.5 rounded-md text-zinc-600 dark:text-zinc-400 hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors">Terminated</a>
      </nav>
      <div class="flex items-center gap-2 shrink-0">
        <a href="/logout" class="text-xs font-semibold px-2.5 py-1.5 rounded-md border border-zinc-200 dark:border-zinc-700 text-zinc-600 dark:text-zinc-300 hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors">Logout</a>
        <button id="theme-toggle" type="button" aria-label="Toggle theme" class="h-8 w-8 inline-flex items-center justify-center rounded-md border border-zinc-200 dark:border-zinc-700 bg-transparent text-zinc-500 dark:text-zinc-400 hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors">
          <svg class="h-4 w-4 block dark:hidden" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
          <svg class="h-4 w-4 hidden dark:block" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
        </button>
        <button id="nav-toggle" type="button" aria-expanded="false" aria-controls="nav-mobile" class="md:hidden h-8 w-8 inline-flex items-center justify-center rounded-md border border-zinc-200 dark:border-zinc-700 bg-transparent text-zinc-500 dark:text-zinc-400 hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors">
          <span class="sr-only">Open menu</span>
          <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 7h16M4 12h16M4 17h16"/></svg>
        </button>
      </div>
    </div>
    <div id="nav-mobile" class="hidden md:hidden border-t border-zinc-200 dark:border-zinc-800 px-4 py-2 bg-white dark:bg-zinc-950 flex-col gap-1">
      <a href="/admin/locations/{{ .Location.Number }}" class="text-xs font-semibold px-2.5 py-1.5 rounded-md text-zinc-600 dark:text-zinc-400 hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors">Apps</a>
      <a href="/admin/locations/{{ .Location.Number }}/employees" class="text-xs font-semibold px-2.5 py-1.5 rounded-md bg-zinc-900 text-white dark:bg-zinc-100 dark:text-zinc-900">Employees</a>
      <a href="/admin/locations/{{ .Location.Number }}/employees/archived" class="text-xs font-semibold px-2.5 py-1.5 rounded-md text-zinc-600 dark:text-zinc-400 hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors">Terminated</a>
    </div>
  </header>

  <div class="pt-14 min-h-[calc(100vh-3.5rem)] px-4 py-8">
    <div class="mx-auto max-w-[800px]">
      <div class="card">
        <a class="back" href="/admin/locations/{{ .Location.Number }}">&#8592; Back to Apps</a>
        <h1>{{ .Location.Name }}</h1>

        <div class="meta-grid" style="margin-top:0.75rem;">
          <div class="meta-label">Location Number</div>
          <div class="meta-value">{{ .Location.Number }}</div>
        </div>

        {{ if .SuccessMessage }}<p class="notice ok">{{ .SuccessMessage }}</p>{{ end }}
        {{ if .Error }}<p class="notice error">{{ .Error }}</p>{{ end }}

        <section class="hub">
          <button class="hub-btn" type="button" data-target="add-employees">
            <strong>Add Employees</strong>
            <span>Create a new employee with first and last name only.</span>
          </button>
          <button class="hub-btn" type="button" data-target="view-employees">
            <strong>View Employees</strong>
            <span>Browse new hires, active employees, and terminated employees.</span>
          </button>
        </section>

        <section class="section" data-panel="add-employees">
          <h2>Add Employee</h2>
          <form method="post" action="/admin/locations/{{ .Location.Number }}/employees/create" enctype="multipart/form-data">
            <input type="hidden" name="csrf_token" value="{{ .CSRF }}">
            <label for="add-first-name">First Name</label>
            <input id="add-first-name" type="text" name="first_name" placeholder="First Name" required>
            <label for="add-last-name">Last Name</label>
            <input id="add-last-name" type="text" name="last_name" placeholder="Last Name" required>
            <label for="add-department-id">Department</label>
            <select id="add-department-id" name="department_id" required>
              <option value="">Select department</option>
              {{ range .LocationDepartments }}
                <option value="{{ .ID }}">{{ .Name }}</option>
              {{ end }}
            </select>
            <label for="add-job-id">Job</label>
            <select id="add-job-id" name="job_id" required>
              <option value="">Select department first</option>
              {{ range .LocationJobs }}
                <option
                  value="{{ .ID }}"
                  data-department-ids="{{ if .DepartmentIDs }}{{ range $idx, $id := .DepartmentIDs }}{{ if $idx }},{{ end }}{{ $id }}{{ end }}{{ else if gt .DepartmentID 0 }}{{ .DepartmentID }}{{ end }}"
                >{{ .Name }}{{ if .DepartmentName }} ({{ .DepartmentName }}){{ end }}</option>
              {{ end }}
            </select>
            <label for="add-pay-type">Pay Type</label>
            <select id="add-pay-type" name="pay_type" required>
              <option value="">Select pay type</option>
              <option value="hourly">Hourly</option>
              <option value="salary">Salary</option>
            </select>
            <label for="add-pay-amount">Pay Amount</label>
            <input id="add-pay-amount" type="number" name="pay_amount" min="0.01" step="0.01" placeholder="Example: 16.50 or 52000" required>
            <button type="submit" {{ if or (not .LocationJobs) (not .LocationDepartments) }}disabled{{ end }}>Create Employee</button>
            {{ if or (not .LocationJobs) (not .LocationDepartments) }}
              <p class="text-muted" style="margin:0;">Create at least one department and one job before adding employees.</p>
            {{ end }}
          </form>
        </section>

        <section class="section" data-panel="view-employees">
          <div class="employees-head">
            <h2>Employee Status</h2>
            <a class="archive-link" href="/admin/locations/{{ .Location.Number }}/employees/archived">Open Terminated Page</a>
          </div>
          <div class="employee-status-subnav">
            <button class="employee-status-btn" type="button" data-employee-status-target="new-hires">New Hires</button>
            <button class="employee-status-btn" type="button" data-employee-status-target="active-employees">Active Employees</button>
            <button class="employee-status-btn" type="button" data-employee-status-target="terminated-employees">Terminated Employees</button>
          </div>
          <div class="employee-search">
            <input id="employee-search-input" type="text" placeholder="Search employee by name">
            <div id="employee-search-meta" class="employee-search-meta">Showing {{ len .NewHireEmployees }} of {{ len .NewHireEmployees }}</div>
          </div>
          <div class="employee-status-panel" data-employee-status-panel="new-hires">
            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th colspan="4">New Hires ({{ len .NewHireEmployees }})</th>
                  </tr>
                  <tr>
                    <th>Name</th>
                    <th>Department</th>
                    <th>Email</th>
                    <th>Phone</th>
                  </tr>
                </thead>
                <tbody>
                  {{ if .NewHireEmployees }}
                    {{ range .NewHireEmployees }}
                      <tr class="employee-row" data-search-name="{{ .FirstName }} {{ .LastName }}">
                        <td><a class="location-link" href="/admin/locations/{{ $.Location.Number }}/employees/{{ .TimePunchName }}">{{ .FirstName }} {{ .LastName }}</a></td>
                        <td>{{ if .Department }}{{ .Department }}{{ else }}INIT{{ end }}</td>
                        <td>{{ if .Email }}{{ .Email }}{{ else }}-{{ end }}</td>
                        <td>{{ if .Phone }}{{ .Phone }}{{ else }}-{{ end }}</td>
                      </tr>
                    {{ end }}
                  {{ else }}
                    <tr><td colspan="4">No new hires right now.</td></tr>
                  {{ end }}
                </tbody>
              </table>
            </div>
          </div>
          <div class="employee-status-panel" data-employee-status-panel="active-employees">
            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th colspan="4">Active Employees ({{ len .ActiveEmployees }})</th>
                  </tr>
                  <tr>
                    <th>Name</th>
                    <th>Department</th>
                    <th>Email</th>
                    <th>Phone</th>
                  </tr>
                </thead>
                <tbody>
                  {{ if .ActiveEmployees }}
                    {{ range .ActiveEmployees }}
                      <tr class="employee-row" data-search-name="{{ .FirstName }} {{ .LastName }}">
                        <td><a class="location-link" href="/admin/locations/{{ $.Location.Number }}/employees/{{ .TimePunchName }}">{{ .FirstName }} {{ .LastName }}</a></td>
                        <td>{{ if .Department }}{{ .Department }}{{ else }}INIT{{ end }}</td>
                        <td>{{ if .Email }}{{ .Email }}{{ else }}-{{ end }}</td>
                        <td>{{ if .Phone }}{{ .Phone }}{{ else }}-{{ end }}</td>
                      </tr>
                    {{ end }}
                  {{ else }}
                    <tr><td colspan="4">No active employees right now.</td></tr>
                  {{ end }}
                </tbody>
              </table>
            </div>
          </div>
          <div class="employee-status-panel" data-employee-status-panel="terminated-employees">
            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th colspan="4">Terminated Employees ({{ len .ArchivedEmployees }})</th>
                  </tr>
                  <tr>
                    <th>Name</th>
                    <th>Time Punch</th>
                    <th>Email</th>
                    <th>Terminated At (UTC)</th>
                  </tr>
                </thead>
                <tbody>
                  {{ if .ArchivedEmployees }}
                    {{ range .ArchivedEmployees }}
                      <tr class="employee-row" data-search-name="{{ .FirstName }} {{ .LastName }}">
                        <td><a class="location-link" href="/admin/locations/{{ $.Location.Number }}/employees/archived/{{ .TimePunchName }}">{{ .FirstName }} {{ .LastName }}</a></td>
                        <td>{{ .TimePunchName }}</td>
                        <td>{{ if .Email }}{{ .Email }}{{ else }}-{{ end }}</td>
                        <td>{{ .ArchivedAt }}</td>
                      </tr>
                    {{ end }}
                  {{ else }}
                    <tr><td colspan="4">No terminated employees right now.</td></tr>
                  {{ end }}
                </tbody>
              </table>
            </div>
          </div>
        </section>
      </div>
    </div>
  </div>

  <script>
    const employeeRows = Array.from(document.querySelectorAll(".employee-row"));
    const employeeSearchInput = document.getElementById("employee-search-input");
    const employeeSearchMeta = document.getElementById("employee-search-meta");
    const hubButtons = Array.from(document.querySelectorAll(".hub-btn"));
    const panels = Array.from(document.querySelectorAll(".section[data-panel]"));
    const addDepartmentSelect = document.getElementById("add-department-id");
    const addJobSelect = document.getElementById("add-job-id");
    const employeeStatusButtons = Array.from(document.querySelectorAll(".employee-status-btn"));
    const employeeStatusPanels = Array.from(document.querySelectorAll(".employee-status-panel[data-employee-status-panel]"));

    function showPanel(panelName) {
      hubButtons.forEach((btn) => btn.classList.toggle("active", btn.dataset.target === panelName));
      panels.forEach((panel) => panel.classList.toggle("active", panel.dataset.panel === panelName));
      if (window.location.hash !== "#" + panelName) {
        window.history.replaceState(null, "", "#" + panelName);
      }
    }

    hubButtons.forEach((btn) => {
      btn.addEventListener("click", () => showPanel(btn.dataset.target));
    });

    function showEmployeeStatusPanel(panelName) {
      employeeStatusButtons.forEach((btn) => btn.classList.toggle("active", btn.dataset.employeeStatusTarget === panelName));
      employeeStatusPanels.forEach((panel) => panel.classList.toggle("active", panel.dataset.employeeStatusPanel === panelName));
      filterEmployeesByName();
    }

    employeeStatusButtons.forEach((btn) => {
      btn.addEventListener("click", () => showEmployeeStatusPanel(btn.dataset.employeeStatusTarget));
    });

    showEmployeeStatusPanel("new-hires");
    const initialPanel = (window.location.hash || "").replace("#", "");
    if (initialPanel && panels.some((panel) => panel.dataset.panel === initialPanel)) {
      showPanel(initialPanel);
    } else {
      showPanel("view-employees");
    }

    function normalizeSearchText(value) {
      return (value || "").toLowerCase().trim();
    }

    function filterEmployeesByName() {
      if (!employeeSearchInput || employeeRows.length === 0) {
        return;
      }
      const query = normalizeSearchText(employeeSearchInput.value);
      const activeStatusPanel = document.querySelector(".employee-status-panel.active");
      const scopedRows = activeStatusPanel ? Array.from(activeStatusPanel.querySelectorAll(".employee-row")) : employeeRows;
      let visible = 0;
      employeeRows.forEach((row) => {
        const isInActivePanel = scopedRows.includes(row);
        const fullName = normalizeSearchText(row.dataset.searchName);
        const match = isInActivePanel && (query === "" || fullName.includes(query));
        row.style.display = match ? "" : "none";
        if (match) {
          visible += 1;
        }
      });
      if (employeeSearchMeta) {
        employeeSearchMeta.textContent = "Showing " + visible + " of " + scopedRows.length;
      }
    }

    if (employeeSearchInput) {
      employeeSearchInput.addEventListener("input", filterEmployeesByName);
      filterEmployeesByName();
    }

    function syncJobOptionsByDepartment(departmentSelect, jobSelect) {
      if (!departmentSelect || !jobSelect) return;
      const selectedDepartment = (departmentSelect.value || "").trim();
      const options = Array.from(jobSelect.options || []);
      const placeholder = options[0] || null;
      let visibleCount = 0;
      options.forEach((option, index) => {
        if (index === 0) return;
        const departmentIDs = (option.dataset.departmentIds || "")
          .split(",")
          .map((value) => value.trim())
          .filter(Boolean);
        const match = selectedDepartment !== "" && departmentIDs.includes(selectedDepartment);
        option.hidden = !match;
        if (match) visibleCount += 1;
      });
      if (!selectedDepartment) {
        if (placeholder) placeholder.textContent = "Select department first";
      } else if (visibleCount === 0) {
        if (placeholder) placeholder.textContent = "No jobs in this department";
      } else {
        if (placeholder) placeholder.textContent = "Select job";
      }
      if (!selectedDepartment || (jobSelect.value && jobSelect.selectedOptions[0] && jobSelect.selectedOptions[0].hidden)) {
        jobSelect.value = "";
      }
      jobSelect.disabled = !selectedDepartment || visibleCount === 0;
    }

    if (addDepartmentSelect && addJobSelect) {
      addDepartmentSelect.addEventListener("change", function () {
        syncJobOptionsByDepartment(addDepartmentSelect, addJobSelect);
      });
      syncJobOptionsByDepartment(addDepartmentSelect, addJobSelect);
    }

  </script>

  <script>
    (function () {
      var storageKey = "cfasuite-theme";
      var root = document.documentElement;
      var toggle = document.getElementById("theme-toggle");
      var navToggle = document.getElementById("nav-toggle");
      var navMobile = document.getElementById("nav-mobile");
      if (toggle) {
        toggle.addEventListener("click", function () {
          var isDark = root.classList.toggle("dark");
          localStorage.setItem(storageKey, isDark ? "dark" : "light");
        });
      }
      if (navToggle && navMobile) {
        navToggle.addEventListener("click", function () {
          var expanded = navToggle.getAttribute("aria-expanded") === "true";
          navToggle.setAttribute("aria-expanded", expanded ? "false" : "true");
          navMobile.classList.toggle("hidden", expanded);
          if (!expanded) { navMobile.style.display = "flex"; } else { navMobile.style.removeProperty("display"); }
        });
      }
    })();
  </script>

</body>
</html>
