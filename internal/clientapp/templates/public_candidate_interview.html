<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Interview Scorecard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@500;600;700;800&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/assets/app.css">
  <script>
    (function () {
      var stored = localStorage.getItem("cfasuite-theme");
      var prefersDark = window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches;
      var theme = stored === "light" || stored === "dark" ? stored : (prefersDark ? "dark" : "light");
      document.documentElement.classList.toggle("dark", theme === "dark");
    })();
  </script>
  <style>
    :root {
      --bg: #ffffff; --fg: #09090b; --card: #ffffff;
      --muted: #f4f4f5; --muted-fg: #71717a; --border: #e4e4e7;
      --primary: #004f71; --primary-fg: #ffffff; --danger:#dc2626;
    }
    html.dark {
      --bg: #09090b; --fg: #fafafa; --card: #09090b;
      --muted: #27272a; --muted-fg: #a1a1aa; --border: #3f3f46;
      --primary: #004f71; --primary-fg: #ffffff; --danger:#f87171;
    }
    * { box-sizing: border-box; }
    body { margin: 0; background: var(--bg); color: var(--fg); font-family: "Manrope", sans-serif; }
    .wrap { max-width: 900px; margin: 0 auto; padding: 2rem 1rem; display:grid; gap:1rem; }
    .card { border: 1px solid var(--border); border-radius: 12px; background: var(--card); padding: 1rem; }
    h1, h2 { font-family: "Space Grotesk", sans-serif; margin: 0; }
    .meta { color: var(--muted-fg); font-size: 0.875rem; }
    .stack { display: grid; gap: 0.875rem; }
    label { display:block; font-weight:600; font-size:0.875rem; margin-bottom:0.3rem; }
    input, select, textarea { width:100%; min-height:2.4rem; border:1px solid var(--border); border-radius:8px; background:var(--bg); color:var(--fg); padding:0.55rem 0.65rem; font:inherit; }
    textarea { min-height: 8rem; resize: vertical; }
    .value-card { border:1px solid var(--border); border-radius:10px; padding:0.875rem; }
    .grid-2 { display:grid; gap:0.75rem; grid-template-columns: repeat(2, minmax(0,1fr)); }
    @media (max-width: 760px) { .grid-2 { grid-template-columns: 1fr; } }
    .btn { min-height:2.4rem; border:1px solid var(--primary); background:var(--primary); color:var(--primary-fg); border-radius:8px; padding:0.5rem 0.85rem; font-weight:700; cursor:pointer; }
    .msg { font-size:0.875rem; }
    .msg.error { color: var(--danger); }
    .completion {
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 0.75rem;
      background: var(--muted);
      display: grid;
      gap: 0.35rem;
    }
    .completion.ok {
      border-color: #86efac;
      background: #f0fdf4;
      color: #166534;
    }
    html.dark .completion.ok {
      border-color: #166534;
      background: #052e16;
      color: #4ade80;
    }
    .completion.warn {
      border-color: #2f8fb8;
      background: #e6f2f7;
      color: #003b55;
    }
    html.dark .completion.warn {
      border-color: #003b55;
      background: #002a3c;
      color: #2f8fb8;
    }
    .required-empty { color: var(--danger); }
    .required-complete { color: #16a34a; }
    .value-card.card-incomplete {
      border-color: #2f8fb8;
      background: #e6f2f7;
    }
    .value-card.card-complete {
      border-color: #86efac;
      background: #f0fdf4;
    }
    html.dark .value-card.card-incomplete {
      border-color: #003b55;
      background: #002a3c;
    }
    html.dark .value-card.card-complete {
      border-color: #166534;
      background: #052e16;
    }
    .submit-row { display: grid; gap: 0.5rem; }
  </style>
</head>
<body>
  <div class="wrap">
    <section class="card stack">
      <h1>Interview Scorecard</h1>
      <p class="meta">Location: {{ if .Location }}{{ .Location.Name }} ({{ .Location.Number }}){{ end }}</p>
      <p class="meta">Candidate: {{ if .Candidate }}{{ .Candidate.FirstName }} {{ .Candidate.LastName }}{{ end }}</p>
      <p class="meta">Interviewer: {{ if .Employee }}{{ .Employee.TimePunchName }}{{ end }} | Type: {{ .ReturnPath }}</p>
      {{ if .Error }}<p class="msg error">{{ .Error }}</p>{{ end }}
      {{ if .SuccessMessage }}<p class="msg">{{ .SuccessMessage }}</p>{{ end }}

      <form id="interview-form" method="post" action="/interview/{{ .Token }}" class="stack">
        <section id="completion-summary" class="completion warn" aria-live="polite">
          <strong>Form Incomplete</strong>
          <span id="completion-detail">Complete all required fields before submitting.</span>
        </section>
        {{ range .CandidateValues }}
          <article class="value-card stack required-group">
            <div>
              <h2 style="font-size:1rem;">{{ .Name }}</h2>
              {{ if .Description }}<p class="meta" style="margin-top:0.25rem;">{{ .Description }}</p>{{ end }}
            </div>
            <div class="grid-2">
              <div>
                <label class="required-label" for="grade_{{ .ID }}">Grade</label>
                <select id="grade_{{ .ID }}" name="grade_{{ .ID }}" required>
                  <option value="" selected>Select grade</option>
                  <option value="A">A</option>
                  <option value="B">B</option>
                  <option value="C">C</option>
                  <option value="D">D</option>
                  <option value="F">F</option>
                </select>
              </div>
              <div>
                <label class="required-label" for="comment_{{ .ID }}">Comment (required, up to 1000 chars)</label>
                <textarea id="comment_{{ .ID }}" name="comment_{{ .ID }}" maxlength="1000" required placeholder="What did you observe for this value?"></textarea>
              </div>
            </div>
          </article>
        {{ end }}
        <section class="stack">
          <h2 style="font-size:1rem;">Interview Questions</h2>
          {{ if .InterviewQuestions }}
            {{ range .InterviewQuestions }}
              <article class="value-card stack required-group">
                <div>
                  <h2 style="font-size:1rem;">{{ .Question }}</h2>
                </div>
                <div>
                  <label class="required-label" for="question_{{ .ID }}">Answer (required, up to 3000 chars)</label>
                  <textarea id="question_{{ .ID }}" name="question_{{ .ID }}" maxlength="3000" required placeholder="Enter interview response"></textarea>
                </div>
              </article>
            {{ end }}
          {{ else }}
            <p class="meta">No interview questions are configured for this interview type.</p>
          {{ end }}
        </section>
        <div>
          <label for="notes">Overall Interview Notes</label>
          <textarea id="notes" name="notes" maxlength="3000" placeholder="Optional overall comments."></textarea>
        </div>
        <div class="submit-row">
          <button id="interview-submit-btn" class="btn" type="submit">Complete Interview</button>
          <span id="submit-help" class="meta">All required fields must be complete.</span>
        </div>
      </form>
    </section>
  </div>
  <script>
    (function () {
      var form = document.getElementById("interview-form");
      var summary = document.getElementById("completion-summary");
      var detail = document.getElementById("completion-detail");
      var submitBtn = document.getElementById("interview-submit-btn");
      var submitHelp = document.getElementById("submit-help");
      if (!form || !summary || !detail || !submitBtn) return;

      var requiredFields = Array.from(form.querySelectorAll("select[required], textarea[required], input[required]"));
      var requiredLabels = Array.from(form.querySelectorAll(".required-label"));
      var groups = Array.from(form.querySelectorAll(".required-group"));

      function isComplete(el) {
        if (!el) return false;
        if (el.tagName === "SELECT") return (el.value || "").trim() !== "";
        return (el.value || "").trim() !== "";
      }

      function nearestGroup(el) {
        return el ? el.closest(".required-group") : null;
      }

      function refreshState() {
        var completeCount = 0;
        requiredFields.forEach(function (field) {
          if (isComplete(field)) completeCount += 1;
        });
        requiredLabels.forEach(function (label) {
          var target = form.querySelector("#" + CSS.escape(label.getAttribute("for")));
          var complete = isComplete(target);
          label.classList.toggle("required-empty", !complete);
          label.classList.toggle("required-complete", complete);
        });
        groups.forEach(function (group) {
          var fields = Array.from(group.querySelectorAll("select[required], textarea[required], input[required]"));
          var complete = fields.length > 0 && fields.every(isComplete);
          group.classList.toggle("card-incomplete", !complete);
          group.classList.toggle("card-complete", complete);
        });

        var total = requiredFields.length;
        var allComplete = total > 0 && completeCount === total;
        summary.classList.toggle("ok", allComplete);
        summary.classList.toggle("warn", !allComplete);
        summary.querySelector("strong").textContent = allComplete ? "Form Complete" : "Form Incomplete";
        detail.textContent = allComplete
          ? ("All required fields complete (" + completeCount + "/" + total + ").")
          : ("Required fields complete: " + completeCount + "/" + total + ".");
        submitBtn.disabled = !allComplete;
        if (submitHelp) {
          submitHelp.textContent = allComplete
            ? "Everything required is complete. You can submit."
            : "Complete all required fields to enable submit.";
        }
      }

      requiredFields.forEach(function (field) {
        ["input", "change", "blur"].forEach(function (eventName) {
          field.addEventListener(eventName, refreshState);
        });
      });

      form.addEventListener("submit", function (event) {
        refreshState();
        if (submitBtn.disabled) {
          event.preventDefault();
        }
      });

      refreshState();
    })();
  </script>
</body>
</html>
